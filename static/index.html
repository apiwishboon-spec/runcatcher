<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#216487">
    <title>LibraryRunCatcher | Teacher Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/style.css?v=2.3">
    <link rel="icon" type="image/png" href="/static/logo.png?v=2.3">
    <link rel="shortcut icon" href="/static/logo.png?v=2.3">
    <link rel="manifest" href="/static/manifest.json?v=2.3">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

</head>

<body class="bg-light">
    <!-- Particle System Canvas -->
    <canvas id="particle-canvas" class="particle-canvas"></canvas>

    <!-- Dynamic Aura Background -->
    <div id="aura-bg" class="aura-bg state-quiet">
        <div class="aura-sphere aura-sphere-1"></div>
        <div class="aura-sphere aura-sphere-2"></div>
    </div>

    <!-- Intro Overlay -->
    <div id="intro-overlay" class="intro-overlay">
        <div class="intro-text">
            <img src="/static/logo.png?v=2.3" alt="Logo" width="120" height="120"
                class="mb-4 bg-white rounded-4 shadow-lg p-3 mx-auto d-block">
            Library Run
            <span>Catcher</span>
            <div class="intro-slogan">Smart monitoring for quiet study spaces</div>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4 border-bottom">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="/static/logo.png?v=2.3" alt="Logo" height="32" class="me-2 rounded-circle bg-white p-1">
                LibraryRunCatcher
            </a>
            <div class="ms-auto d-flex align-items-center gap-2">
                <button class="btn btn-sm btn-outline-primary d-flex align-items-center gap-2 position-relative"
                    data-bs-toggle="modal" data-bs-target="#notificationModal">
                    <i data-lucide="bell" style="width: 16px; height: 16px;"></i>
                    <span id="notification-badge"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none"
                        style="font-size: 0.6rem;">
                        0
                    </span>
                </button>
                <button onclick="toggleDashboard()"
                    class="btn btn-sm btn-outline-primary d-flex align-items-center gap-2">
                    <i data-lucide="layout-dashboard" style="width: 14px; height: 14px;"></i>
                    <span class="d-none d-md-inline">Dashboard</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Dashboard Overlay (Iframe) -->
    <div id="dashboard-overlay" class="position-fixed top-0 start-0 w-100 h-100 bg-white"
        style="z-index: 10000; display: none;">
        <iframe id="dashboard-frame" src="" class="w-100 h-100 border-0"></iframe>
    </div>

    <div class="container">
        <div class="row g-4">
            <!-- Main Monitoring Card -->
            <div class="col-md-8">
                <div class="card border-0 shadow-sm glass-card">
                    <div class="card-body p-4">
                        <div
                            class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4 gap-3">
                            <h4 class="card-title mb-0 w-100 text-center text-md-start">Live Monitoring</h4>
                            <div
                                class="d-flex align-items-center gap-2 flex-wrap justify-content-center justify-content-md-end w-100">
                                <button id="summon-btn"
                                    class="btn btn-sm btn-danger d-flex align-items-center gap-2 px-3 fw-bold"
                                    onclick="triggerStaffSummon()" title="Emergency: Summon All Staff">
                                    <i data-lucide="bell-ring" style="width: 16px; height: 16px;"></i> SUMMON
                                </button>
                                <button id="preview-btn" class="btn btn-sm btn-outline-info" onclick="togglePreview()"
                                    title="Show Camera Preview">
                                    <i data-lucide="eye" style="width: 16px; height: 16px;"></i>
                                </button>
                                <button id="fullscreen-btn" class="btn btn-sm btn-outline-secondary"
                                    onclick="toggleFullscreen()" title="Toggle Fullscreen">
                                    <i data-lucide="maximize" style="width: 16px; height: 16px;"></i>
                                </button>
                                <div class="form-check form-switch pt-1 ms-1">
                                    <input class="form-check-input" type="checkbox" id="live-toggle">
                                    <label class="form-check-label fw-bold small" for="live-toggle">Auto</label>
                                </div>
                                <div id="status-badge" class="badge bg-success py-2 px-3 rounded-pill ms-1">
                                    All Quiet
                                </div>
                            </div>
                        </div>

                        <!-- Camera Preview (Optional toggle) -->
                        <div id="camera-container" class="position-relative mt-3 rounded overflow-hidden"
                            style="display: none; aspect-ratio: 4/3; background: #000;">
                            <video id="input-video" class="w-100 h-100 object-fit-contain"
                                style="display: none;"></video>
                            <canvas id="output-canvas" class="w-100 h-100 object-fit-contain"
                                style="display: none;"></canvas>
                            <canvas id="grid-overlay-canvas" class="position-absolute top-0 start-0 w-100 h-100"
                                style="pointer-events: none; display: none;"></canvas>
                            <div id="grid-overlay-label" class="position-absolute top-0 start-0 p-2 text-white small"
                                style="background: rgba(0,0,0,0.5); display: none;">Grid Alignment Active</div>
                        </div>

                        <div id="status-display" class="text-center py-5">
                            <div class="status-icon-wrapper mb-3">
                                <i data-lucide="smile" id="main-icon" class="text-success" size="64"></i>
                            </div>
                            <h2 id="status-message" class="fw-bold text-dark">Environment is Peaceful</h2>
                            <p class="text-muted">No disruptions detected in current zones.</p>
                        </div>

                        <div class="row text-center mt-4">
                            <div class="col-6 col-md-3">
                                <div class="p-3 bg-light rounded shadow-sm border">
                                    <small class="text-uppercase text-muted d-block mb-1">Speed</small>
                                    <span id="stat-speed" class="h4 fw-bold">0.0</span> <small>m/s</small>
                                    <div class="progress mt-2" style="height: 4px;">
                                        <div id="speed-meter" class="progress-bar bg-primary" role="progressbar"
                                            style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="p-3 bg-light rounded shadow-sm border">
                                    <small class="text-uppercase text-muted d-block mb-1">Noise</small>
                                    <span id="stat-noise" class="h4 fw-bold">0</span> <small>dB</small>
                                    <div class="progress mt-2" style="height: 4px;">
                                        <div id="noise-meter" class="progress-bar bg-info" role="progressbar"
                                            style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="p-3 bg-light rounded shadow-sm border">
                                    <small class="text-uppercase text-muted d-block mb-1">Streak</small>
                                    <span id="stat-streak" class="h4 fw-bold text-primary">0</span>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="p-3 bg-light rounded shadow-sm border">
                                    <small class="text-uppercase text-muted d-block mb-1">Zone</small>
                                    <span id="stat-zone" class="h5 fw-bold">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alerts Sidebar -->
            <div class="col-md-4">
                <div class="card border-0 shadow-sm glass-card h-100">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
                            <h5 class="card-title mb-0 d-flex align-items-center">
                                <i data-lucide="bell" class="me-2 text-warning"></i> Recent Alerts
                            </h5>
                            <div class="d-flex gap-2">
                                <button id="download-all-btn" class="btn btn-sm btn-outline-primary"
                                    onclick="downloadAllReports()">
                                    <i data-lucide="download" class="me-1" style="width: 14px; height: 14px;"></i> All
                                </button>
                                <button id="clear-alerts-btn" class="btn btn-sm btn-outline-danger"
                                    onclick="clearAllAlerts()">
                                    <i data-lucide="trash-2" class="me-1" style="width: 14px; height: 14px;"></i> Clear
                                </button>
                            </div>
                        </div>
                        <div id="alerts-container" class="vstack gap-3">
                            <div id="alerts-placeholder" class="text-center text-muted py-5">
                                <small>No recent alerts.</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Zone Selection, Grid Settings & Librarian's Watch -->
    <div class="container mt-4 mb-5">
        <div class="row g-4">
            <!-- Zone Selection -->
            <div class="col-md-4">
                <div class="card border-0 shadow-sm glass-card h-100">
                    <div class="card-body p-4">
                        <h5 class="card-title mb-3 d-flex align-items-center">
                            <i data-lucide="map-pin" class="me-2 text-primary"></i> Zone Selection
                        </h5>
                        <div class="vstack gap-3">
                            <div>
                                <label class="form-label fw-bold">Monitoring Zone</label>
                                <select id="zone-select" class="form-select">
                                    <option value="reading_area">Reading Area</option>
                                    <option value="computer_lab">Computer Lab</option>
                                    <option value="study_hall">Study Hall</option>
                                    <option value="quiet_zone">Quiet Zone</option>
                                </select>
                            </div>
                            <div class="row g-2">
                                <div class="col-8">
                                    <input type="text" id="new-zone-input" class="form-control"
                                        placeholder="New zone name...">
                                </div>
                                <div class="col-4">
                                    <button id="add-zone-btn" class="btn btn-primary w-100" onclick="addNewZone()">
                                        <i data-lucide="plus" style="width: 16px; height: 16px;"></i> Add
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Grid Settings -->
            <div class="col-md-4">
                <div class="card border-0 shadow-sm glass-card h-100">
                    <div class="card-body p-4">
                        <h5 class="card-title mb-3 d-flex align-items-center">
                            <i data-lucide="grid" class="me-2 text-info"></i> CCTV Grid Configuration
                        </h5>
                        <div class="vstack gap-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="grid-mode-toggle">
                                <label class="form-check-label fw-bold" for="grid-mode-toggle">Enable Grid
                                    Detection</label>
                            </div>
                            <div id="grid-settings-content" style="opacity: 0.5; pointer-events: none;">
                                <div class="mb-3">
                                    <label class="form-label small fw-bold">Quick Presets</label>
                                    <div class="btn-group w-100" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-info preset-grid-btn"
                                            data-rows="2" data-cols="2">2×2</button>
                                        <button type="button" class="btn btn-sm btn-outline-info preset-grid-btn"
                                            data-rows="3" data-cols="3">3×3</button>
                                        <button type="button" class="btn btn-sm btn-outline-info preset-grid-btn"
                                            data-rows="4" data-cols="4">4×4</button>
                                    </div>
                                </div>
                                <div class="row g-3">
                                    <div class="col-6">
                                        <label class="form-label small fw-bold">Rows</label>
                                        <input type="number" id="grid-rows" class="form-control" value="2" min="1"
                                            max="4">
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label small fw-bold">Columns</label>
                                        <input type="number" id="grid-cols" class="form-control" value="2" min="1"
                                            max="4">
                                    </div>
                                </div>
                                <div class="mt-2 text-muted small">
                                    <i data-lucide="info" style="width: 12px; height: 12px;"></i> Active cells highlight
                                    when motion detected.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Librarian's Watch Sync -->
            <div class="col-md-4">
                <div class="card border-0 shadow-sm glass-card h-100">
                    <div class="card-body p-4">
                        <h5
                            class="card-title mb-3 d-flex align-items-center text-warning justify-content-between flex-wrap gap-2">
                            <span class="d-flex align-items-center">
                                <i data-lucide="smartphone" class="me-2"></i> Librarian's Watch
                            </span>
                            <a href="#" class="text-warning opacity-75 small text-decoration-none fw-normal"
                                data-bs-toggle="modal" data-bs-target="#watchHelpModal">
                                <i data-lucide="help-circle" style="width: 14px; height: 14px;"></i> How to use
                            </a>
                        </h5>
                        <div class="vstack gap-3">
                            <div class="d-flex gap-2">
                                <input type="text" id="sync-code-input" class="form-control font-monospace"
                                    placeholder="Room Code..." readonly>
                                <button onclick="copySyncCode()" class="btn btn-outline-secondary" title="Copy Code">
                                    <i data-lucide="copy" style="width: 16px; height: 16px;"></i>
                                </button>
                                <button onclick="generateSyncCode()" class="btn btn-outline-warning">
                                    <i data-lucide="refresh-cw" style="width: 16px; height: 16px;"></i>
                                </button>
                            </div>
                            <div id="sync-status" class="alert alert-light py-2 px-3 m-0 small border d-none">
                                <div class="d-flex align-items-center">
                                    <span class="spinner-grow spinner-grow-sm text-warning me-2" role="status"></span>
                                    <span>Syncing Active...</span>
                                </div>
                            </div>
                            <div class="row g-2">
                                <div class="col-7">
                                    <input type="text" id="join-code-input" class="form-control"
                                        placeholder="Enter Code...">
                                </div>
                                <div class="col-5">
                                    <button onclick="joinSyncRoom()"
                                        class="btn btn-warning w-100 text-white fw-bold">Join</button>
                                </div>
                            </div>
                            <small class="text-muted">Sync multiple devices. Phone vibrates on alert.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for snapshot viewing -->
    <div class="modal fade" id="snapshotModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content glass-card border-0">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold">Alert Snapshot</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center p-0">
                    <img id="snapshot-img" src="" class="img-fluid" alt="Snapshot" crossorigin="anonymous">
                </div>
                <div class="modal-footer bg-light border-0 d-flex justify-content-between p-3">
                    <div class="d-flex gap-4">
                        <div class="text-start">
                            <small class="text-muted d-block">Time Detected</small>
                            <span id="modal-time" class="fw-bold">00:00:00</span>
                        </div>
                        <div class="text-start">
                            <small class="text-muted d-block">Sound Level</small>
                            <span id="modal-noise" class="fw-bold text-info">0 dB</span>
                        </div>
                        <div class="text-start">
                            <small class="text-muted d-block">Movement Speed</small>
                            <span id="modal-speed" class="fw-bold text-danger">0.0 m/s</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="downloadPDFReport()">
                        <i data-lucide="download" class="me-1" style="width: 16px; height: 16px;"></i> Report
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Librarian's Watch Help -->
    <div class="modal fade" id="watchHelpModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass-card border-0">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold text-warning">How to use: Librarian's Watch</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ol class="small text-muted vstack gap-3">
                        <li><strong>On your Laptop (Station):</strong> Click the refresh icon <i
                                data-lucide="refresh-cw" style="width: 12px;"></i> to generate a code, then click
                            <strong>Join</strong>.
                        </li>
                        <li><strong>On your Phone/Watch:</strong> Open this same URL, enter the code in the
                            <strong>Join</strong> box, and click <strong>Join</strong>.
                        </li>
                        <li><strong>Start Monitoring:</strong> Once both are joined, keep your phone in your pocket. It
                            will vibrate and chime whenever an alert is triggered by the laptop's camera.</li>
                    </ol>
                    <div class="alert alert-warning py-2 mt-3 small border-0 opacity-75">
                        <i data-lucide="info" class="me-1" style="width: 14px;"></i> Keep the browser tab open on your
                        phone for haptics.
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Notification Modal -->
    <div class="modal fade" id="notificationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass-card border-0">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold text-primary">Latest Updates & News</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="notification-items-container">
                    <div class="text-center py-4 text-muted">
                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                        Loading updates...
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-primary w-100" data-bs-dismiss="modal">Got it!</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Sponsor Modal (small) -->
    <!-- Sponsor Modal (small) -->
    <div class="modal fade" id="sponsorModal" tabindex="-1">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content glass-card border-0">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold">Sponsor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center p-3">
                    <img src="/static/spornserme.png" alt="Sponsor" class="img-fluid">
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Modal (large, scrollable) -->
    <div class="modal fade" id="privacyModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content glass-card border-0">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold">Privacy Policy</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4" style="max-height:65vh; overflow:auto;">
                    <h4>Privacy Policy</h4>
                    <h5>LibraryRunCatcher</h5>
                    <p class="small text-muted"><strong>Last Updated:</strong> 2029-01-01</p>

                    <p class="small text-muted">LibraryRunCatcher is a privacy-first behavioral monitoring system built
                        for educational environments. This Privacy Policy explains what data is processed, how it is
                        handled, and why we intentionally keep it minimal as hell.</p>

                    <h6>1. Privacy by Architecture</h6>
                    <p class="small text-muted">LibraryRunCatcher is designed with these core principles baked in (not
                        bolted on later):</p>
                    <ul class="small text-muted">
                        <li>Client-side AI processing only</li>
                        <li>No continuous recording</li>
                        <li>No identity recognition</li>
                        <li>Ephemeral data storage</li>
                        <li>No data selling, ever</li>
                        <li>Educational-use focus</li>
                    </ul>
                    <p class="small text-muted">If a feature violates these principles, it doesn’t make it into
                        production. Period.</p>

                    <h6>2. Data Processing Overview</h6>
                    <h6>2.1 Camera and Microphone Access</h6>
                    <p class="small text-muted">Used solely for real-time motion speed and sound level detection. Raw
                        video and audio never leave the user’s device. No facial recognition, voice identification, or
                        biometric profiling.</p>

                    <h6>2.2 AI Pose and Motion Data</h6>
                    <p class="small text-muted">Non-identifiable skeletal keypoints, movement vectors and speed
                        calculations. Processed in memory and discarded immediately unless an alert occurs.</p>

                    <h6>3. Incident Evidence Data</h6>
                    <p class="small text-muted">When a running or noise violation is detected, the system may generate a
                        single evidence snapshot. This snapshot may include:</p>
                    <ul class="small text-muted">
                        <li>Timestamp</li>
                        <li>Zone or virtual camera cell</li>
                        <li>Detection type</li>
                        <li>Speed (m/s) or sound level (dB)</li>
                    </ul>
                    <p class="small text-muted">No continuous video is stored. No tracking across time. No personal
                        identity attached.</p>

                    <h6>Retention Policy</h6>
                    <p class="small text-muted">Evidence is stored temporarily and automatically deleted after 5 hours.
                        Background cleanup runs continuously.</p>

                    <h6>4. Data We Explicitly Do NOT Collect</h6>
                    <p class="small text-muted">LibraryRunCatcher does not collect:</p>
                    <ul class="small text-muted">
                        <li>Names, emails, phone numbers</li>
                        <li>Facial or biometric identifiers</li>
                        <li>User accounts or profiles</li>
                        <li>Location tracking data</li>
                        <li>Advertising or analytics data</li>
                        <li>Third-party tracking cookies</li>
                    </ul>

                    <h6>5. Multi-Device Sync (Librarian’s Watch)</h6>
                    <p class="small text-muted">Uses temporary, rotating room codes. No persistent identifiers. No
                        accounts required. Connections exist only during active sessions. Once the session ends, the
                        data disappears. Like a responsible adult.</p>

                    <h6>6. Cookies and Local Storage</h6>
                    <p class="small text-muted">Local storage is used only for UI preferences and temporary session
                        state. No cross-site tracking. No marketing cookies. No creepy stuff.</p>

                    <h6>7. Security Measures</h6>
                    <p class="small text-muted">HTTPS enforced. No public access to evidence files. Automatic data
                        expiration. No long-term server-side media storage.</p>

                    <h6>8. Student and Child Privacy</h6>
                    <p class="small text-muted">LibraryRunCatcher is designed for institutional supervision, not
                        personal surveillance. No student identity data is collected. No profiling or behavioral
                        scoring. Supports compliance with FERPA, GDPR principles, and Thailand PDPA.</p>

                    <h6>9. Changes to This Policy</h6>
                    <p class="small text-muted">If this policy changes, documentation will be updated. The core privacy
                        principles will not be weakened. That’s a hard rule.</p>

                    <h6>10. Contact</h6>
                    <p class="small text-muted">Project Maintainer: APIWISH ANUTARAVANICHKUL<br>See official project
                        repository for contact and documentation.</p>

                    <p class="small text-muted">© 2029 APIWISH ANUTARAVANICHKUL<br>LibraryRunCatcher — Privacy-First by
                        Design</p>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms of Service Modal (large, scrollable) -->
    <div class="modal fade" id="tosModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content glass-card border-0">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold">Terms of Service</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4" style="max-height:65vh; overflow:auto;">
                    <h4>Terms of Service</h4>
                    <h5>LibraryRunCatcher</h5>
                    <p class="small text-muted"><strong>Last Updated:</strong> 2029-01-01</p>

                    <p class="small text-muted">By using LibraryRunCatcher, you agree to the following Terms of Service.
                        This is the boring-but-important governance layer. Let’s keep it sane.</p>

                    <h6>1. Intended Use</h6>
                    <p class="small text-muted">LibraryRunCatcher is intended only for Libraries, Schools, Educational
                        institutions, and Supervised learning environments.</p>
                    <p class="small text-muted">It is not intended for Personal surveillance, Law enforcement, Workplace
                        monitoring, Home surveillance, or Punitive or discriminatory use. If you use it that way, that’s
                        on you — not the software.</p>

                    <h6>2. User Responsibilities</h6>
                    <p class="small text-muted">By deploying LibraryRunCatcher, you agree to obtain proper institutional
                        approval, inform staff and students when monitoring is active, follow applicable privacy and
                        education laws, and use the system ethically and proportionally. Human judgment is required. The
                        AI is a tool, not a judge.</p>

                    <h6>3. No Guarantee of Accuracy</h6>
                    <p class="small text-muted">LibraryRunCatcher uses probabilistic AI models. Detections are
                        indicators, not absolute truth. False positives and negatives may occur. All decisions must be
                        reviewed by a human authority.</p>

                    <h6>4. Evidence Usage</h6>
                    <p class="small text-muted">Generated evidence is contextual and time-bound and must be reviewed
                        before action. It should follow institutional disciplinary policies. The system is not liable
                        for misuse, overreach, or dumb decisions made downstream.</p>

                    <h6>5. Availability and Reliability</h6>
                    <p class="small text-muted">LibraryRunCatcher is provided “as is”: No uptime guarantees, no warranty
                        of uninterrupted service, and features may change across versions.</p>

                    <h6>6. Open-Source License</h6>
                    <p class="small text-muted">LibraryRunCatcher is released under the Apache License 2.0. You may use,
                        modify, and redistribute. You may not remove license notices, misrepresent authorship, or claim
                        endorsement or certification.</p>

                    <h6>7. Limitation of Liability</h6>
                    <p class="small text-muted">To the maximum extent permitted by law, the authors are not liable for
                        misuse of the system, data loss, policy violations, or disciplinary outcomes.</p>

                    <h6>8. Termination</h6>
                    <p class="small text-muted">You may stop using LibraryRunCatcher at any time. Use may be restricted
                        if the system is deployed in violation of these terms or applicable laws.</p>

                    <h6>9. Governing Principles</h6>
                    <p class="small text-muted">This system is governed by Transparency, Data minimization, Human
                        oversight, and Educational ethics.</p>

                    <h6>10. Acceptance</h6>
                    <p class="small text-muted">By deploying or using LibraryRunCatcher, you acknowledge that you have
                        read, understood, and agreed to these Terms.</p>

                    <p class="small text-muted">© 2029 APIWISH ANUTARAVANICHKUL<br>LibraryRunCatcher — Built for
                        Education, Not Surveillance</p>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="container mt-5 mb-4 text-center d-flex justify-content-center align-items-center gap-2">
        <p class="text-muted mb-0" style="font-size: 9pt;">© 2029 APIWISH ANUTARAVANICHKUL</p>

        <div class="d-flex align-items-center gap-2">
            <button class="btn btn-link btn-sm p-0" data-bs-toggle="modal" data-bs-target="#sponsorModal"
                title="Sponsor">
                <img src="/static/slogo.png" alt="Sponsor" height="18" class="rounded me-1">Sponsor
            </button>

            <button class="btn btn-link btn-sm p-0" data-bs-toggle="modal" data-bs-target="#privacyModal"
                title="Privacy Policy">
                Privacy Policy
            </button>

            <button class="btn btn-link btn-sm p-0" data-bs-toggle="modal" data-bs-target="#tosModal"
                title="Terms of Service">
                Terms of Service
            </button>
        </div>
    </footer>

    <script>
        function toggleDashboard() {
            const overlay = document.getElementById('dashboard-overlay');
            const frame = document.getElementById('dashboard-frame');

            if (overlay.style.display === 'none') {
                // Open
                if (!frame.src.includes('dashboard')) {
                    frame.src = "/dashboard";
                }
                overlay.style.display = 'block';
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            } else {
                // Close
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // Listen for close message from iframe
        window.addEventListener('message', (event) => {
            if (event.data === 'closeDashboard') {
                toggleDashboard();
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/app.js?v=2.3"></script>
    <script>
        lucide.createIcons();

        // Remove intro after animation to prevent interaction issues
        const intro = document.getElementById('intro-overlay');
        if (intro) {
            intro.addEventListener('animationend', () => {
                intro.style.display = 'none';
            });
            // Fallback just in case
            setTimeout(() => {
                intro.style.display = 'none';
            }, 3600);
        }
    </script>
    <script>
        // Notification System Logic
        async function loadNotifications() {
            const container = document.getElementById('notification-items-container');
            const badge = document.getElementById('notification-badge');

            try {
                // Add version for cache busting
                const response = await fetch('/static/notifications.json?v=' + Date.now());
                const notifications = await response.json();

                let newCount = 0;
                let html = '<div class="vstack gap-3">';

                notifications.forEach(item => {
                    if (item.isNew) newCount++;

                    const borderClass = item.isNew ? 'border-primary bg-light' : 'border-light';
                    const iconColor = item.isNew ? 'text-primary' : 'text-muted';

                    html += `
                        <div class="d-flex gap-3 p-3 rounded-4 border-start border-4 ${borderClass}">
                            <div class="${iconColor}"><i data-lucide="${item.icon || 'info'}"></i></div>
                            <div>
                                <h6 class="fw-bold mb-1">${item.title}</h6>
                                <p class="small text-muted mb-0">${item.description}</p>
                                <small class="${item.isNew ? 'text-primary fw-bold' : 'text-muted'}" style="font-size: 0.7rem;">${item.date}</small>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                container.innerHTML = html;

                if (newCount > 0) {
                    badge.innerText = newCount;
                    badge.classList.remove('d-none');
                } else {
                    badge.classList.add('d-none');
                }

                lucide.createIcons();
            } catch (err) {
                console.error('Failed to load notifications:', err);
                container.innerHTML = '<div class="text-center py-4 text-muted small">No updates found.</div>';
            }
        }

        // Load on startup
        document.addEventListener('DOMContentLoaded', loadNotifications);

        // Refresh every 5 minutes
        setInterval(loadNotifications, 300000);
    </script>
</body>

</html>